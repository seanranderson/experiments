% This is a generic function used to share instructions or information with 
% a participant during an experiment. It has several buttons. "Next" allows
% the participant to progress to the next panel of information. "Help" pulls 
% a panel using the `Help.m` function providing any information the 
% participant should have if there are technical issues. This function is 
% intended to be called repeatedly throughout an experimental protocol and 
% integrated with other functions relevant to an experiment used to complete 
% specific tasks.
% 
% Sean R. Anderson - sean.hearing@gmail.com
% 
% Inputs:   str: Structure containing instructions to be displayed with data 
%               (string), pos (2 element column matrix), and siz (2 column 
%               matrix) fields.
%           img: Structure containing image files to be displayed with 
%               filename (string), pos (2 element column vector), and type 
%               (string) fields
%           btn: Structure containing buttons to be displayed with n 
%               (double), text (string), callback (string), pos (2 element 
%               column vector), and siz (2 element column vector)

function GenGUI(str,img,btn)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Load data and clear existing figure
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    hndl = get(gcf, 'UserData');
    clf(hndl.ExpFig);
    hndl.npanel = hndl.npanel + 1;
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Generate text, images, and buttons
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    % Display desired text
    uicontrol('Style','text',...
        'String',str.data, ...
        'backgroundcolor',hndl.colors.gray,...
        'FontSize',1,...
        'FontUnits','normalized',...
        'Units', 'normalized', 'Position',[str.pos str.siz],...
        'HorizontalAlignment','Center');
    
    % Display desired images
    if exist('img','var')
        if ~isempty(img)
            h = subplot(2, 1, 2);
            h.Position = h.Position + [img.pos];
            imshow(imread(img.filename,img.type));
            axis off;
        end
    end
    
    % Display desired buttons
    if exist('btn','var')
        if ~isempty(btn)
            for ii = 1:btn.n
                eval(sprintf(strcat("hndl.ExpButtons.%s = ",...
                    "uicontrol('Style', 'pushbutton', 'String', '%s',",...
                    "'FontWeight', 'bold',",...
                    "'FontSize', 8,",...
                    "'FontUnits','normalized',",...
                    "'backgroundcolor',hndl.colors.%s,",...
                    "'callback',{@%s,hndl.npanel},",...
                    "'Units', 'normalized',",...
                    "'Position',[%0.3f %0.3f %0.3f %0.3f]);"),...
                    btn.string{ii},btn.string{ii},...
                    btn.color{ii},btn.callback{ii},...
                    btn.pos{ii}(1),btn.pos{ii}(2),...
                    btn.siz{ii}(1),btn.siz{ii}(2)));
            end
        end
    end
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Next and help buttons
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    hndl.ExpButtons.Next = uicontrol('Style', 'pushbutton', 'String', 'Next', ...
        'FontWeight', 'bold', ...
        'FontSize', 8, ...
        'FontUnits','normalized',...
        'backgroundcolor',[1 0.1 0.1], ...
        'callback',{@WelcomeScreenHomeDelivery,hndl.npanel}, ...
        'Units', 'normalized', 'Position',[0.885,0.1,0.1,0.052]);

    hndl.ExpButtons.GetHelp = uicontrol('Style', 'pushbutton', 'String', 'Help', ...
        'FontWeight', 'bold', ...
        'FontSize', 8, ...
        'FontUnits','normalized',...
        'backgroundcolor',[1 0.1 0.1], ...
        'callback',{@Help,0}, ...
        'Units', 'normalized', 'Position',[0.115,0.1,0.1,0.052]);

    % Store data to handle
    set(gcf, 'UserData', hndl);
    
end
